services:
  pixagram:
    image: mkysel/pixagram:testnet-x86
    container_name: pixagram_container

    entrypoint:
      - /bin/bash
      - -lc
      - ulimit -n 1048576; exec /home/hived_admin/docker_entrypoint.sh /home/hived/bin/hived

    expose:
      - "7777"
    ports:
      - "2001:2001"  # P2P (direct to internet)

    volumes:
      - ./pixagram:/home/hived/datadir
      # make sure this maps to DATADIR in the imageâ€™s ENV

    # (optional) if the entrypoint script relies on environment vars:
    environment:
      - DATADIR=/home/hived/datadir
      - SHM_DIR=/home/hived/datadir/blockchain
      - HTTP_PORT=7777
      - HIVED_UID=1000
    ulimits:
      nofile:
        soft: 1048576
        hard: 1048576
    networks:
      - backend

  pixagram_haf:
    image: mkysel/pixagram-haf:testnet-x86
    container_name: pixagram_haf_container

    depends_on:
      - pixagram

    command:
      - --p2p-seed-node=pixagram:2001

    expose:
      - "7778"  # HTTP
      - "8092"  # WS
    ports:
      - "2002:2002"  # P2P (direct to internet)

    volumes:
      - ./pixagram-haf:/home/hived/datadir

    environment:
      - DATADIR=/home/hived/datadir
      - SHM_DIR=/home/hived/datadir/blockchain
      - HTTP_PORT=7778
      - WS_PORT=8092
      - P2P_PORT=2002
      - HIVED_UID=1000
      - PG_ACCESS=local haf_block_log haf_maintainer trust\nhost haf_block_log haf_app_admin 172.0.0.0/8 trust\nhost all pghero 172.0.0.0/8 trust

    ulimits:
      nofile:
        soft: 1048576
        hard: 1048576
    networks:
      - backend

  nginx:
    image: nginx:alpine
    container_name: pixagram_nginx
    depends_on:
      - pixagram
      - pixagram_haf
    ports:
      - "7777:7777"  # Pixagram HTTP
      - "7778:7778"  # Pixagram HAF HTTP
      - "8092:8092"  # Pixagram HAF WS
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
    networks:
      - backend

networks:
  backend:
    driver: bridge
